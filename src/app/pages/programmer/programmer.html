<app-header></app-header>

<page-container class="page page--programmer" @pageIn>
  <div class="hero">
    <div>
      <h1 class="title">
        <span class="title__spark" aria-hidden="true"></span>
        Panel del Programador
      </h1>
      <p class="subtitle">Gestiona tus proyectos y responde solicitudes de asesorías.</p>
    </div>

    <a class="btn-new" routerLink="/programmer/new-project">
      + Nuevo Proyecto
      <span class="btn-new__glow" aria-hidden="true"></span>
    </a>
  </div>

  <!-- PROYECTOS -->
  <section class="card" @listIn>
    <div class="section-head">
      <div>
        <h2>Mis Proyectos</h2>
        <p>Agrega, edita y comparte tus trabajos.</p>
      </div>

      <div class="right">
        <span class="pill pill--neutral" *ngIf="loadingProjects">Cargando…</span>
        <span class="pill pill--ok" *ngIf="!loadingProjects">Listo</span>
      </div>
    </div>

    <div *ngIf="loadingProjects" class="skeleton">
      <div class="sk-card" *ngFor="let _ of [1,2,3]">
        <div class="sk sk-title"></div>
        <div class="sk sk-line"></div>
        <div class="sk sk-line"></div>
        <div class="sk sk-chip"></div>
      </div>
    </div>

    <div *ngIf="!loadingProjects && projects.length === 0" class="empty card">
      No tienes proyectos aún. Crea tu primer proyecto con el botón “Nuevo Proyecto”.
    </div>

    <div class="project-grid" *ngIf="!loadingProjects && projects.length > 0">
      <div class="project-item anim-item" *ngFor="let p of projects">
        <div class="project-top">
          <h3>{{ p.title }}</h3>
          <span class="pill pill--neutral">{{ p.type }}</span>
        </div>

        <p class="muted">{{ p.description }}</p>

        <div class="meta">
          <span><b>Rol:</b> {{ p.role }}</span>
          <span><b>Tecnologías:</b> {{ p.technologies.join(', ') }}</span>
        </div>

        <div class="links" *ngIf="p.repoURL || p.demoURL">
          <a *ngIf="p.repoURL" [href]="p.repoURL" target="_blank" rel="noopener">Repositorio</a>
          <a *ngIf="p.demoURL" [href]="p.demoURL" target="_blank" rel="noopener">Demo</a>
        </div>

        <div class="actions">
          <a class="ghost-link" [routerLink]="['/programmer/edit', p.id]">Editar</a>
          <button class="danger-btn" (click)="deleteProject(p)">Eliminar</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ASESORÍAS -->
  <section class="card" @listIn>
    <div class="section-head">
      <div>
        <h2>Solicitudes de Asesorías</h2>
        <p>Aprueba o rechaza las solicitudes pendientes.</p>
      </div>
    </div>

    <div *ngIf="asesorias.length === 0" class="empty card">
      No tienes solicitudes por el momento.
    </div>

    <div class="asesoria-list" *ngIf="asesorias.length > 0">
      <div class="asesoria-item anim-item" *ngFor="let a of asesorias">
        <div class="row">
          <div class="who">
            <div class="avatar" aria-hidden="true">
              <span>{{ (a.name || 'A').slice(0,1) }}</span>
            </div>
            <div>
              <b>{{ a.name }}</b>
              <div class="muted small">{{ a.date }} • {{ a.hour }}</div>
            </div>
          </div>

          <span class="pill pill--neutral">{{ a.status }}</span>
        </div>

        <p class="muted">{{ a.comment }}</p>

        <div class="actions">
          <button
            *ngIf="a.status === 'pending'"
            (click)="approve(a)"
            class="approve-btn"
          >
            Aprobar
          </button>

          <button
            *ngIf="a.status === 'pending'"
            (click)="reject(a)"
            class="reject-btn"
          >
            Rechazar
          </button>
        </div>
      </div>
    </div>
  </section>
</page-container>
