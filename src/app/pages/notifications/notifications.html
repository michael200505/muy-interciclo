<app-header></app-header>

<page-container class="page page--user" @pageIn>
  <div class="top">
    <div>
      <h1>Notificaciones</h1>
      <p class="muted">Mantente al día con asesorías y actualizaciones.</p>
    </div>

    <div class="top-actions" *ngIf="!loading && items.length > 0">
      <span class="pill" [class.pill--neutral]="unreadCount()===0">
        {{ unreadCount() }} sin leer
      </span>

      <button class="ghost-btn" (click)="markAllRead()">
        Marcar todas como leídas
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="card skeleton">
    <div class="sk-row"></div>
    <div class="sk-row"></div>
    <div class="sk-row"></div>
  </div>

  <div *ngIf="!loading && items.length === 0" class="card empty anim-in">
    No tienes notificaciones aún.
  </div>

  <div class="list" *ngIf="!loading && items.length > 0">
    <article
      class="n-card anim-in"
      *ngFor="let n of items; trackBy: trackById"
      [class.unread]="!n.read"
    >
      <div class="n-head">
        <div class="left">
          <span class="pill pill--new" *ngIf="!n.read">NUEVO</span>
          <h3>{{ n.title }}</h3>
        </div>

        <div class="meta">
          {{ n.createdAt ? (n.createdAt | date:'dd/MM/yyyy HH:mm') : '' }}
        </div>
      </div>

      <p class="msg">{{ n.message }}</p>

      <div class="extra" *ngIf="n.date || n.hour">
        <span class="pill pill--neutral" *ngIf="n.date"><b>Fecha:</b>&nbsp;{{ n.date }}</span>
        <span class="pill pill--neutral" *ngIf="n.hour"><b>Hora:</b>&nbsp;{{ n.hour }}</span>
      </div>

      <div class="actions">
        <button class="primary-btn" (click)="markRead(n)" *ngIf="!n.read">
          Marcar leído
        </button>

        <button class="ghost-btn" (click)="simulateEmail(n)">
          Enviar correo
        </button>

        <button class="ghost-btn" (click)="simulateWhatsapp(n)">
          Enviar WhatsApp
        </button>
      </div>
    </article>
  </div>
</page-container>
