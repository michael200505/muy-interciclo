<app-header></app-header>

<page-container class="page page--admin">
  <h1>Panel de Administrador</h1>
  <h2>Gestión de Usuarios</h2>

  <div *ngIf="loading">Cargando...</div>

  <!-- Tabla de usuarios -->
  <table *ngIf="!loading && !selectedUser">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>Rol</th>
        <th>Acción</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let user of allUsers">
        <td>{{ user.displayName }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.role }}</td>

        <td>
          <button (click)="startProgrammerSetup(user)">Crear Perfil Programador</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Formulario para crear programador -->
  <div *ngIf="selectedUser" class="form-box">
    <h2>Crear Perfil para: {{ selectedUser.displayName }}</h2>

    <label>Nombre:</label>
    <input [(ngModel)]="newProgrammer.name" type="text">

    <label>Especialidad:</label>
    <input [(ngModel)]="newProgrammer.specialty" type="text">

    <label>Descripción:</label>
    <textarea [(ngModel)]="newProgrammer.description"></textarea>

    <label>Foto URL:</label>
    <input [(ngModel)]="newProgrammer.photoURL" type="text">

    <h3>Contactos</h3>

    <label>Email:</label>
    <input [(ngModel)]="newProgrammer.contactLinks.email" type="text">

    <label>LinkedIn:</label>
    <input [(ngModel)]="newProgrammer.contactLinks.linkedin" type="text">

    <label>GitHub:</label>
    <input [(ngModel)]="newProgrammer.contactLinks.github" type="text">

    <label>WhatsApp:</label>
    <input [(ngModel)]="newProgrammer.contactLinks.whatsapp" type="text">

    <div class="btn-group">
      <button (click)="saveProgrammerProfile()" class="primary-btn">Guardar</button>
      <button (click)="selectedUser = null">Cancelar</button>
    </div>
  </div>

  <!-- DISPONIBILIDAD -->
  <section class="form-box" style="margin-top:24px;">
    <h2>Disponibilidad de Programadores</h2>

    <label>Programador</label>
    <select [(ngModel)]="selectedProgrammerId" (change)="loadSlots()">
      <option value="">-- Selecciona --</option>
      <option *ngFor="let p of programmers" [value]="p.uid">
        {{ p.name }}
      </option>
    </select>

    <label>Filtrar por fecha (opcional)</label>
    <input type="date" [(ngModel)]="slotDate" (change)="loadSlots()"/>

    <div class="btn-group" style="align-items:end;">
      <div style="flex:1;">
        <label>Hora</label>
        <input type="time" [(ngModel)]="slotHour"/>
      </div>

      <button class="primary-btn" (click)="addSlot()">Agregar hora</button>
    </div>

    <div style="margin-top:12px;">
      <div *ngIf="loadingSlots">Cargando horarios...</div>

      <div *ngIf="!loadingSlots && selectedProgrammerId && slots.length === 0">
        No hay horarios registrados.
      </div>

      <div *ngIf="!loadingSlots && selectedProgrammerId && slots.length > 0">
        <div *ngFor="let s of slots"
             style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #ddd;">
          <div><b>{{ s.date }}</b> — {{ s.hour }} ({{ s.status }})</div>
          <button (click)="removeSlot(s)">Eliminar</button>
        </div>
      </div>
    </div>
  </section>
</page-container>
