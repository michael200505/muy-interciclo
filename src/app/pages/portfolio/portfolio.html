<app-header></app-header>

<page-container class="page page--public" @pageIn>
  <!-- Estados -->
  <div *ngIf="loading" class="pill pill--neutral">Cargando portafolio‚Ä¶</div>

  <div *ngIf="!loading && notFound" class="empty card">
    <h2>Portafolio no encontrado</h2>
    <p class="muted">El usuario no existe o no tiene un perfil de programador creado.</p>
    <div class="btn-group">
      <button class="ghost-btn" routerLink="/home">Volver a Home</button>
    </div>
  </div>

  <ng-container *ngIf="!loading && programmer">
    <!-- HERO -->
    <section class="hero card anim-in">
      <div class="hero__glow" aria-hidden="true"></div>

      <div class="hero__top">
        <img
          class="avatar-lg"
          [src]="programmer.photoURL || 'https://via.placeholder.com/160'"
          alt="Foto de {{ programmer.name }}"
          loading="lazy"
        />

        <div class="hero__info">
          <div class="hero__nameRow">
            <h1 class="hero__name">{{ programmer.name }}</h1>
            <span class="pill pill--neutral">Programador</span>
          </div>

          <p class="hero__spec">{{ programmer.specialty || 'Especialidad no especificada' }}</p>
          <p class="hero__desc">{{ programmer.description || 'Sin descripci√≥n.' }}</p>

          <div class="hero__cta">
            <button class="primary-btn" (click)="agendar(programmer.uid)">
              Agendar asesor√≠a
            </button>
            <button class="ghost-btn" routerLink="/home">Ver otros</button>
          </div>

          <!-- CONTACTOS -->
          <div class="chips">
            <a *ngIf="programmer.contactLinks?.email"
               class="chip"
               [href]="'mailto:' + programmer.contactLinks?.email">
              ‚úâÔ∏è <span class="chip__text">{{ programmer.contactLinks?.email }}</span>
            </a>

            <a *ngIf="programmer.contactLinks?.github"
               class="chip"
               [href]="programmer.contactLinks?.github"
               target="_blank" rel="noopener">
              üíª <span class="chip__text">GitHub</span>
            </a>

            <a *ngIf="programmer.contactLinks?.linkedin"
               class="chip"
               [href]="programmer.contactLinks?.linkedin"
               target="_blank" rel="noopener">
              üîó <span class="chip__text">LinkedIn</span>
            </a>

            <a *ngIf="programmer.contactLinks?.whatsapp"
               class="chip chip--ok"
               [href]="whatsappLink(programmer.contactLinks?.whatsapp)"
               target="_blank" rel="noopener">
              üí¨ <span class="chip__text">WhatsApp</span>
            </a>

            <a *ngIf="programmer.socialLinks?.twitter"
               class="chip"
               [href]="programmer.socialLinks?.twitter"
               target="_blank" rel="noopener">
              üê¶ <span class="chip__text">Twitter/X</span>
            </a>

            <a *ngIf="programmer.socialLinks?.instagram"
               class="chip"
               [href]="programmer.socialLinks?.instagram"
               target="_blank" rel="noopener">
              üì∏ <span class="chip__text">Instagram</span>
            </a>

            <a *ngIf="programmer.socialLinks?.facebook"
               class="chip"
               [href]="programmer.socialLinks?.facebook"
               target="_blank" rel="noopener">
              üìò <span class="chip__text">Facebook</span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- TABS -->
    <section class="tabs card">
      <button
        type="button"
        class="tab"
        [class.active]="activeTab === 'professional'"
        (click)="setTab('professional')">
        Profesionales
        <span class="pill pill--neutral">{{ professionalProjects.length }}</span>
      </button>

      <button
        type="button"
        class="tab"
        [class.active]="activeTab === 'academic'"
        (click)="setTab('academic')">
        Acad√©micos
        <span class="pill pill--neutral">{{ academicProjects.length }}</span>
      </button>
    </section>

    <!-- LIST -->
    <section class="stack" @listIn>
      <!-- Profesionales -->
      <ng-container *ngIf="activeTab === 'professional'">
        <div *ngIf="professionalProjects.length === 0" class="empty card">
          No hay proyectos profesionales todav√≠a.
        </div>

        <div class="project-grid" *ngIf="professionalProjects.length > 0">
          <article class="project-card anim-item" *ngFor="let p of professionalProjects; trackBy: trackById">
            <div class="project-top">
              <h3>{{ p.title }}</h3>
              <span class="pill pill--neutral">Profesional</span>
            </div>

            <p class="muted">{{ p.description }}</p>

            <div class="meta">
              <span><b>Rol:</b> {{ p.role }}</span>
              <span><b>Tecnolog√≠as:</b> {{ p.technologies.join(', ') }}</span>
            </div>

            <div class="links" *ngIf="p.repoURL || p.demoURL">
              <a *ngIf="p.repoURL" [href]="p.repoURL" target="_blank" rel="noopener">Repositorio</a>
              <a *ngIf="p.demoURL" [href]="p.demoURL" target="_blank" rel="noopener">Demo</a>
            </div>
          </article>
        </div>
      </ng-container>

      <!-- Acad√©micos -->
      <ng-container *ngIf="activeTab === 'academic'">
        <div *ngIf="academicProjects.length === 0" class="empty card">
          No hay proyectos acad√©micos todav√≠a.
        </div>

        <div class="project-grid" *ngIf="academicProjects.length > 0">
          <article class="project-card anim-item" *ngFor="let p of academicProjects; trackBy: trackById">
            <div class="project-top">
              <h3>{{ p.title }}</h3>
              <span class="pill pill--neutral">Acad√©mico</span>
            </div>

            <p class="muted">{{ p.description }}</p>

            <div class="meta">
              <span><b>Rol:</b> {{ p.role }}</span>
              <span><b>Tecnolog√≠as:</b> {{ p.technologies.join(', ') }}</span>
            </div>

            <div class="links" *ngIf="p.repoURL || p.demoURL">
              <a *ngIf="p.repoURL" [href]="p.repoURL" target="_blank" rel="noopener">Repositorio</a>
              <a *ngIf="p.demoURL" [href]="p.demoURL" target="_blank" rel="noopener">Demo</a>
            </div>
          </article>
        </div>
      </ng-container>
    </section>
  </ng-container>
</page-container>
